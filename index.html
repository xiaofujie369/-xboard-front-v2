<script>
(function () {
  console.log("å¯äº‘ Popup loaded");

  // =============== é…ç½® ===============
  const FIRST_DELAY = 3000;      // ç¬¬ä¸€æ¬¡å¼¹çª—å»¶è¿Ÿ
  const CLICK_WINDOW = 60000;    // ç¬¬äºŒæ¬¡ç‚¹å‡»ç›‘æ§æ—¶é—´

  let firstDone = false;
  let secondDone = false;
  let popupVisible = false;

  // =============== åˆ›å»ºå¼¹çª— ===============
  function showPopup() {
    if (popupVisible) return;
    popupVisible = true;

    const mask = document.createElement("div");
    mask.id = "kyPopupMask";
    mask.style.cssText = `
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,.55);
      display:flex; justify-content:center; align-items:center;
      z-index: 999999;
    `;

    const box = document.createElement("div");
    box.className = "ky-popup-box";
    box.style.cssText = `
      width: 320px; background:#fff; border-radius:16px;
      padding:22px; text-align:center; font-size:15px;
      box-shadow:0 4px 20px rgba(0,0,0,.18);
      animation: popupShow .25s ease;
    `;

    box.innerHTML = `
      <div class="ky-popup-close" style="
        position:absolute;right:14px;top:10px;
        font-size:22px;color:#999;cursor:pointer;">Ã—</div>

      <h2 style="font-size:20px;margin:10px 0 14px;color:#ff68a0;">ğŸ“¢ æ–°äººå¿…çœ‹å…¬å‘Š</h2>

      <p style="line-height:1.6;">æ¬¢è¿æ¥åˆ°å¯äº‘ï¼Œè¯·åŠ¡å¿…é˜…è¯»é¡¶éƒ¨å…¬å‘Šæ ä¿¡æ¯ã€‚</p>
      <p style="line-height:1.6;">è¯·æ”¶è—æœ€æ–°åœ°å€ï¼š<b>shy521.com</b></p>
      <p style="line-height:1.6;margin-bottom:16px;">
        åŠ å…¥ TG ç¾¤ç»„ï¼š<a href="https://t.me/ss_keyun" target="_blank">t.me/ss_keyun</a>
      </p>

      <button class="ky-popup-btn" style="
        background:#ff68a0;color:#fff;border:none;
        padding:10px 24px;border-radius:10px;
        font-size:15px;cursor:pointer;">æˆ‘å·²çŸ¥æ™“</button>
    `;

    mask.appendChild(box);
    document.body.appendChild(mask);

    // å…³é—­æŒ‰é’®
    box.querySelector(".ky-popup-close").onclick =
      box.querySelector(".ky-popup-btn").onclick =
      () => {
        popupVisible = false;
        mask.remove();
        onPopupClosed();
      };
  }

  // =============== å¼¹çª—å…³é—­å ===============
  function onPopupClosed() {
    if (!firstDone) {
      firstDone = true;
      startClickMonitor();
    } else if (!secondDone) {
      secondDone = true;
    }
  }

  // =============== ç›‘å¬ç¬¬äºŒæ¬¡å¼¹çª— ===============
  function startClickMonitor() {
    const handler = () => {
      if (!secondDone && !popupVisible) {
        showPopup();
      }
      document.removeEventListener("click", handler);
    };

    document.addEventListener("click", handler);

    setTimeout(() => {
      document.removeEventListener("click", handler);
    }, CLICK_WINDOW);
  }

  // =============== ç¬¬ä¸€æ¬¡å¼¹çª—å¯åŠ¨ ===============
  function startFirstPopup() {
    setTimeout(() => {
      if (!firstDone) showPopup();
    }, FIRST_DELAY);
  }

  // =============== å…¥å£ï¼ˆç­‰ React å®Œæˆï¼‰ ===============
  document.addEventListener("DOMContentLoaded", () => {
    setTimeout(startFirstPopup, 2000);
  });

})();
</script>
